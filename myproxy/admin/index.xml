<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<?asciidoc-toc?>
<?asciidoc-numbered?>

<book lang="en">
<bookinfo>
    <title>GT 6.0 MyProxy: System Administrator&#8217;s Guide</title>
</bookinfo>
<chapter id="myproxy-admin-introduction" xreflabel="System Administrator's Guide">
<title>Introduction</title>
<simpara>This guide contains advanced configuration information for system
administrators working with MyProxy. It provides references to
information on procedures typically performed by system administrators,
including installation, configuring, deploying, and testing the
installation.</simpara>
<important><simpara>This information is in addition to the basic Globus Toolkit prerequisite, overview, installation, security configuration instructions in <ulink url="../../admin/install/index.html">../../admin/install/index.html</ulink>. Read through this guide before continuing!</simpara></important>
<simpara>A typical MyProxy configuration has one dedicated myproxy-server for the
site, with MyProxy clients installed on all systems where other Globus
Toolkit client software is installed.</simpara>
</chapter>
<chapter id="myproxy-admin-installing">
<title>Building and Installing</title>
<simpara>MyProxy is built and installed as part of a default GT 6.0 installation.
For basic installation instructions, see
<ulink url="../../admin/install/index.html">../../admin/install/index.html</ulink>. No extra installation steps are
required for this component.</simpara>
<simpara>If you wish to install MyProxy without installing the rest of the Globus
Toolkit, follow the instructions in
<ulink url="../../admin/install/index.html">../../admin/install/index.html</ulink> with the following changes. First,
you do not need Ant, a JDK, or a JDBC database to build only MyProxy.
Second, instead of running "make", run:</simpara>
<screen>globus$ make gsi-myproxy</screen>
<simpara>This will install the MyProxy client and server programs. For
client-only installations, simply do not configure or use the installed
server.</simpara>
</chapter>
<chapter id="myproxy-configuring">
<title>Configuring</title>
<simpara>No additional configuration is required to use MyProxy clients after
they are installed, although you may want to set the MYPROXY_SERVER
environment variable to the hostname of your myproxy-server in the
default user environment on your systems.</simpara>
<simpara>Please refer to the <ulink url="http://myproxy.ncsa.uiuc.edu/adminguide.html">MyProxy
Admin Guide</ulink> for MyProxy server configuration instructions.</simpara>
</chapter>
<chapter id="myproxy-admin-deploying">
<title>Deploying</title>
<simpara>A sample SysV-style boot script for MyProxy is installed at
<literal>$GLOBUS_LOCATION/share/myproxy/etc.init.d.myproxy</literal>. To install on
Linux, copy the file to . To install on Linux, copy the file to
<literal>/etc/rc.d/init.d/myproxy</literal> and run  and run <emphasis role="strong"><literal>chkconfig --add
myproxy</literal></emphasis>. You will need to edit the file to set the
<literal>GLOBUS_LOCATION</literal> environment variable correctly.  environment
variable correctly.</simpara>
<simpara>Alternatively, to run the myproxy server out of inetd or xinetd, you
need to do the following as root:</simpara>
<itemizedlist>
<listitem>
<simpara>
Add the entries in <literal>$GLOBUS_LOCATION/share/myproxy/etc.services</literal>.modifications to the .modifications to the <literal>/etc/services</literal> or  or <literal>/etc/inet/services</literal> file. file.
</simpara>
</listitem>
<listitem>
<simpara>
Add the entries in <literal>$GLOBUS_LOCATION/share/myproxy/etc.inetd.conf.modifications</literal> to  to <literal>/etc/inetd.conf</literal> or  or <literal>/etc/inet/inetd.conf</literal>, or copy , or copy <literal>$GLOBUS_LOCATION/share/myproxy/etc.xinetd.myproxy</literal> to  to <literal>/etc/xinetd.d/myproxy</literal>. You&#8217;ll need to modify the paths in the file according to your installation.. You&#8217;ll need to modify the paths in the file according to your installation.
</simpara>
</listitem>
<listitem>
<simpara>
Reactivate the inetd (or xinetd). This is typically accomplished by sending the SIGHUP signal to the daemon. Refer to the inetd or xinetd man page for your system.
</simpara>
</listitem>
</itemizedlist>
<simpara>In addition, an example cron script is provided in
<literal>$GLOBUS_LOCATION/share/myproxy/myproxy.cron</literal> for removing
expired/revoked credentials from the repository. You will need to edit
the file to set the  for removing expired/revoked credentials from the
repository. You will need to edit the file to set the
<literal>GLOBUS_LOCATION</literal> environment variable correctly before installing in
(for example)  environment variable correctly before installing in (for
example) <literal>/etc/cron.hourly</literal>. .</simpara>
</chapter>
<chapter id="myproxy-admin-testing">
<title>Testing</title>
<simpara>To verify your myproxy-server installation and configuration, you can
run the myproxy-server directly from your shell. If using a host
certificate, you will need to run the myproxy-server as root. First,
make sure your Globus environment is setup in your shell. Set the
<literal>GLOBUS_LOCATION</literal> environment variable to the location of your MyProxy
installation. Then, depending on your shell, run one of the following
commands.  environment variable to the location of your MyProxy
installation. Then, depending on your shell, run one of the following
commands.</simpara>
<simpara>For csh shells:</simpara>
<sidebar>
<simpara><emphasis role="strong"><literal>source $GLOBUS_LOCATION/etc/globus-user-env.csh</literal></emphasis></simpara>
</sidebar>
<simpara>For sh shells:</simpara>
<sidebar>
<simpara><emphasis role="strong"><literal>. $GLOBUS_LOCATION/etc/globus-user-env.sh</literal></emphasis></simpara>
</sidebar>
<simpara>Then, run <emphasis role="strong"><literal>$GLOBUS_LOCATION/sbin/myproxy-server -d</literal></emphasis>. The <emphasis>-d</emphasis>
argument runs the myproxy-server in debug mode. It will write debugging
messages to the terminal and exit after servicing a single request. You
will need to start it once for each test request. In another shell, you
can run the MyProxy client programs to test the server.</simpara>
<simpara>If run without the <emphasis>-d</emphasis> argument, the myproxy-server program will start
up and background itself. It accepts connections on TCP port 7512,
forking off a separate child to handle each incoming connection. It logs
information via the syslog service under the daemon facility.</simpara>
</chapter>
<chapter id="myproxy-admin-security_considerations">
<title>Security Considerations</title>
<section id="myproxy-security-considerations">
<title>MyProxy Security Considerations</title>
<simpara>You should choose a well-protected host to run the myproxy-server on.
Consult with security-aware personnel at your site. You want a host that
is secured to the level of a Kerberos KDC, that has limited user access,
runs limited services, and is well monitored and maintained in terms of
security patches.</simpara>
<simpara>For a typical myproxy-server installation, the host on which the
myproxy-server is running must have /etc/grid-security created and a
host certificate installed. In this case, the myproxy-server will run as
root so it can access the host certificate and key.</simpara>
</section>
</chapter>
<chapter id="myproxy-admin-debugging">
<title>Debugging</title>
<section id="myproxy-logging">
<title>Logging</title>
<simpara>The myproxy-server logs to the system logger (syslog) LOG_DAEMON
facility. Alternatively, run</simpara>
<sidebar>
<simpara><emphasis role="strong"><literal>myproxy-server -d</literal></emphasis></simpara>
</sidebar>
<simpara>from a terminal. In that mode, the myproxy-server will write debugging
messages to the terminal and exit after servicing a single request.</simpara>
</section>
</chapter>
<chapter id="_troubleshooting">
<title>Troubleshooting</title>
<section id="myproxy-error-codes">
<title>Errors</title>
<table
frame="all"
rowsep="1" colsep="1"
>
<title>MyProxy Errors</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="33*"/>
<thead>
<row>
<entry align="left" valign="top"> Error Code </entry>
<entry align="left" valign="top"> Definition </entry>
<entry align="left" valign="top"> Possible Solutions</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>MyProxy server name does not match expected name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>This error appears as a mutual authentication failure or a server authentication failure, and the error message should list two names: the expected name of the MyProxy server and the actual authenticated name.<?asciidoc-br?>
By default, the MyProxy clients expect the MyProxy server to be running with a
host certificate that matches the target hostname.  This error can occur when
running the MyProxy server under a non-host certificate or if the server is
running on a machine with multiple hostnames.&lt;/simpara&gt; The MyProxy clients
authenticate the identity of the MyProxy server to avoid sending passphrases
and credentials to rogue servers.<?asciidoc-br?>
If the expected name contains an IP address, your system is unable to do a
reverse lookup on that address to get the canonical hostname of the server,
indicating either a problem with that machine&#8217;s DNS record or a problem with
the resolver on your system.</simpara></entry>
<entry align="left" valign="top"><simpara>If the server name shown in the error message is acceptable, set the <literal>MYPROXY_SERVER_DN</literal> environment variable to that name to resolve the problem.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Error in bind(): Address already in use</literal></simpara></entry>
<entry align="left" valign="top"><simpara>This error indicates that the myproxy-server port (default: 7512) is in use
  by another process, probably another myproxy-server instance. You cannot run
  multiple instances of the myproxy-server on the same network port.</simpara></entry>
<entry align="left" valign="top"><simpara>If you want to run multiple instances of the myproxy-server on a machine, you
  can specify different ports with the <emphasis>-p</emphasis> option, and then give the same <emphasis>-p</emphasis>
  option to the MyProxy commands to tell them to use the myproxy-server on that
  port.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>grid-proxy-init failed</literal></simpara></entry>
<entry align="left" valign="top"><simpara>This error indicates that the grid-proxy-init command failed when
   myproxy-init attempted to run it, which implies a problem with the
   underlying Globus installation.</simpara></entry>
<entry align="left" valign="top"><simpara>Run <emphasis role="strong"><literal>grid-proxy-init -debug -verify</literal></emphasis> for more information.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>User not authorized</literal></simpara></entry>
<entry align="left" valign="top"><simpara>An error from the myproxy-server saying you are "not authorized" to complete
  an operation typically indicates that the <literal>myproxy-server.config</literal> file
  settings are restricting your access to the myproxy-server. It is possible
  that the myproxy-server is running with the default <literal>myproxy-server.config</literal>
  file, which does not authorize any operations.</simpara></entry>
<entry align="left" valign="top"><simpara>See <ulink url="../myproxy/admin/index.html#myproxy-configuring">Configuring MyProxy</ulink>
  for more information.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Unable to verify remote side&#8217;s credentials</literal></simpara></entry>
<entry align="left" valign="top"><simpara>An error saying "Unable to verify remote side&#8217;s credentials," "Couldn&#8217;t
  verify the remote certificate," or "alert bad certificate" often indicates
  that the client or server&#8217;s certificate is signed by
    an untrusted Certification Authority (CA). The client must have a CA
    certificate and signing policy file installed in
    <literal>/etc/grid-security/certificates</literal> for the CA that signed the server&#8217;s
    certificate. Likewise, the server must have a CA certificate and
    signing policy file installed in <literal>/etc/grid-security/certificates</literal> for
    the CA that signed the client&#8217;s certificate.</simpara></entry>
<entry align="left" valign="top"><simpara>See <ulink url="../../gsic/admin/index.html#gsic-configuring">Configuring
    Certificates</ulink> for more information.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
</chapter>
<chapter id="myproxy-usage">
<title>Usage statistics collection</title>
<section id="myproxy-usage-stats">
<title>MyProxy usage statistics collection</title>
<simpara>By default, the myproxy-server will send a UDP packet containing usage
information to usage-stats.cilogon.org:4810 after serving each request.
See the <ulink url="http://myproxy.ncsa.uiuc.edu/privacy">MyProxy Privacy Policy</ulink> for
details. You can see the Globus Usage Statistics policy
<ulink url="/toolkit/docs/latest-stable/Usage_Stats.html">here</ulink>.</simpara>
</section>
</chapter>
</book>
